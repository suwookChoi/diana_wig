<html lang="ko">
<head>
    <!--디자인팀 meta~link 정리함-->
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,width=device-width">

    <link rel="stylesheet" type="text/css" href="webfont.css"/>
    <link rel="stylesheet" type="text/css" href="jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="daterangepicker.css">
    <link rel="stylesheet" type="text/css" href="common.css"/>
    <link rel="stylesheet" type="text/css" href="style.css"/>

    <script type="text/javascript" src="jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="jquery-ui.js"></script>
    <script type="text/javascript" src="moment.min.js"></script>
    <script type="text/javascript" src="daterangepicker.js"></script>
    <script type="text/javascript" src="common.js"></script>
    <script type="text/javascript" src="style.js"></script>
    <script type="text/javascript" src="header.js"></script>
    
    <script>
        var network;
        $(document).ready(function(){
            getQuotationList();
            window.webkit.messageHandlers.headerHtml.postMessage("quotations");
        });
            
        function headerHtml(menu,id,network_stat){
            header_html("Quotations",id,"Y");
            $(".quotations").parents().parents().children(".li button").css({"color": ""});
            $(".quotations").css({"color": "#d94a67"});
        }

        function getQuotationList() {
            window.webkit.messageHandlers.quotationList.postMessage("");
        }
    
        function html(data, networkYN) {
            network = networkYN;
            if(networkYN == "N"){
                var nwContext = "";
                nwContext += "<div class='almWrap'>";
                nwContext += "    <p>";
                nwContext += "        <img src='ico_alarm.png' alt='Network connection failed'>";
                nwContext += "        Network connection failed.<br>";
                nwContext += "        (It can be different from the actual data.)";
                nwContext += "    </p>";
                nwContext += "</div>";
                
                $(".conWrap").prepend(nwContext);
            }
            
            var list = JSON.parse(data.replaceAll('":null', '":""'));

            var context = "";
            $.each(list, function(index, item) {
                context += "<li>";
                if(item.InsertYN == 'N') {
                    context += "    <a href='javascript:;' onclick='addRowHandlers(this);' class='error'>";
                } else if(item.Flags == '2') {
                    context += "    <a href='javascript:;' onclick='addRowHandlers(this);' class='approved'>";
                } else if(item.Flags == '1') {
                    context += "    <a href='javascript:;' onclick='addRowHandlers(this);' class='pending'>";
                } else {
                    context += "    <a href='javascript:;' onclick='addRowHandlers(this);' class='rejected'>";
                }
                context += "        <i class='sttIco'></i>";
                context += "        <div class='ordDtWrap'>";
                context += "            <strong class='pord CardName'>" + item.CardName + "</strong>";
                context += "            <p class='date DocDate'>" + item.DocDate + "</p>";
                context += "        </div>";
                context += "        <div class='sttWrap'>";
                if(item.InsertYN == 'N') {
                    context += "            <em class='stt Status'>Disconnected</em>";
                } else if(item.Flags == '2') {
                    context += "            <em class='stt Status'>Approved</em>";
                } else if(item.Flags == '1') {
                    context += "            <em class='stt Status'>Pending</em>";
                } else {
                    context += "            <em class='stt Status'>Rejected</em>";
                }
                context += "            <p class='pric'>" + (String(item.PaidSum) != "" ? (Math.floor(item.PaidSum*100)/100).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",") : "") + " " + item.Currency + "</p>";
                context += "        </div>";
                context += "        <input type='hidden' class='DocEntry' value='" + item.DocEntry + "'/>";
                context += "        <input type='hidden' class='CardCode' value='" + item.CardCode + "'/>";
                context += "        <input type='hidden' class='Address' value='" + item.Address + "'/>";
                context += "        <input type='hidden' class='SlpName' value='" + item.SlpName + "'/>";
                
                context += "        <input type='hidden' class='PaidSum' value='" + item.PaidSum + "'/>";
                context += "        <input type='hidden' class='Currency' value='" + item.Currency + "'/>";
                context += "        <input type='hidden' class='DiscountPer' value='" + item.DiscountPer + "'/>";
                context += "        <input type='hidden' class='Item' value='" + JSON.stringify(item.Item) + "'/>";
                context += "    </a>";
                context += "</li>"
            });

            $("#quotationList").html(context);
        }
    
        function addRowHandlers(obj){
            var data = new Object();
            data.DocEntry = $(obj).find('.DocEntry').val();
            data.SlpName = $(obj).find('.SlpName').val();
            data.Status = $(obj).find('.Status').text();
            data.CardCode = $(obj).find('.CardCode').val();
            data.CardName = $(obj).find('.CardName').text();
            data.Address = $(obj).find('.Address').val();
            data.DocDate = $(obj).find('.DocDate').text();
            data.PaidSum = $(obj).find('.PaidSum').val();
            data.Item = JSON.parse($(obj).find('.Item').val());
            
            data.Currency = $(obj).find('.Currency').val();
            data.DiscountPer = $(obj).find('.DiscountPer').val();
            data.NETWORK = network;
            
            window.webkit.messageHandlers.moveQuotationDetail.postMessage(JSON.stringify(data));
        }
    
        function doSearch(){
            var input = $('#findText').val();
            var filter = input.toUpperCase();
            
            $("#quotationList>li").each(function(index){
                var li = $(this);
                var CardName = li.find('.CardName');
                
                if(CardName){
                    CardName = li.find('.CardName').text();
                    
                    if(CardName.toUpperCase().indexOf(filter) > -1) {
                        li.attr('style','display:"";');
                        li.next().attr('style','display:"";');
                    } else {
                        li.attr('style','display:none;');
                        li.next().attr('style','display:none;');
                    }
                }
            });
        }
    </script>
</head>

<body class="Quotations">
    <div class="fixBG"></div>
    <div id='header' class='hdWrap'></div>
    <section>
        <div class="popWrap" id="popWrap_div" style="text-align: center;"></div>
        <div class="schWrap">
            <input type="text" id="findText" placeholder="Search...">
            <button onclick="javascript:doSearch();" class="btnSch">serch</button>
        </div>
        <div class="conWrap qttLst">
            <ul id="quotationList">
            </ul>
        </div>
        
    </section>
</body>

</html>
